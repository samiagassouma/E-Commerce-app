<!-- dashboard.component.html -->
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-wrapper">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-icon">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="header-title">Admin Dashboard</h1>
                        <p class="header-subtitle">System Management Portal</p>
                    </div>
                </div>

                <div class="header-right">
                    <div class="date-time">
                        <p class="date">{{ currentDate | date:'EEEE, MMMM d, y' }}</p>
                        <p class="time">{{ currentDate | date:'HH:mm' }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-wrapper">
        <div class="nav-tabs">
            <button *ngFor="let tab of tabs" (click)="onTabClick(tab.key)" [class]="getTabClasses(tab.key)"
                class="tab-button">
                <ng-container [ngSwitch]="tab.key">
                    <svg *ngSwitchCase="'users'" class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-.5a2.121 2.121 0 11-4.242 0 2.121 2.121 0 014.242 0z">
                        </path>
                    </svg>
                    <svg *ngSwitchCase="'payments'" class="tab-icon" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                        </path>
                    </svg>
                    <svg *ngSwitchCase="'assistants'" class="tab-icon" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                        </path>
                    </svg>
                </ng-container>
                <span class="tab-label">{{ tab.label }}</span>
            </button>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="content-wrapper">
        <!-- Stats Overview -->
        <div class="stats-grid">
        </div>

        <!-- Tab Content -->
        <div [ngSwitch]="activeTab">

            <!-- Users Tab -->
            <div *ngSwitchCase="'users'" class="tab-content">
                <div class="users-charts-grid">
                    <!-- Enhanced Chart Section -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Assistants per User</h3>
                            <div class="chart-legend">
                                <div class="legend-dot"></div>
                                <span class="legend-label">Active Users</span>
                                <div class="chart-icon">
                                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Chart Container with enhanced styling -->
                        <div class="chart-container">
                            <div class="chart-background"></div>
                            <div class="chart-wrapper">
                                <canvas baseChart [data]="usersChartData" [options]="usersChartOptions" [type]="'bar'">
                                </canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart Statistics -->
                <div class="summary-cards">
                    <div class="summary-card summary-green">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Total Users</p>
                                <p class="summary-value">{{ totalUsers }}</p>
                            </div>
                            <div class="summary-icon summary-icon-green">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card summary-orange">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Average</p>
                                <p class="summary-value">{{averageAssistantsPerUser}}</p>
                            </div>
                            <div class="summary-icon summary-icon-orange">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card summary-blue">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Peak Usage</p>
                                <p class="summary-value">{{maxAssistantsPerUser}}</p>
                            </div>
                            <div class="summary-icon summary-icon-blue">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <!-- Payments Tab -->
            <div *ngSwitchCase="'payments'" class="tab-content">
                <!-- Enhanced Payment Charts Section -->
                <div class="charts-grid">

                    <!-- Pie Chart Card -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Payment Distribution</h3>
                            <div class="chart-icon">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-background"></div>
                            <div class="chart-content">
                                <canvas baseChart [data]="paymentPieChartData" [type]="'pie'"
                                    [options]="paymentPieChartOptions">
                                </canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Bar Chart Card -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Revenue by Plan</h3>
                            <div class="chart-icon">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-background"></div>
                            <div class="chart-content">
                                <canvas baseChart [data]="paymentBarChartData" [type]="'bar'"
                                    [options]="paymentBarChartOptions">
                                </canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Line Chart Card -->
                    <div class="chart-card line-chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Revenue Trend</h3>
                            <div class="chart-header-right">
                                <div class="chart-legend">
                                    <div class="legend-dot"></div>
                                    <span class="legend-label">Monthly Revenue</span>
                                </div>
                                <div class="chart-icon">
                                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-background"></div>
                            <div class="chart-content">
                                <canvas baseChart [data]="paymentLineChartData" [type]="'line'"
                                    [options]="paymentLineChartOptions">
                                </canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Revenue Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card summary-orange">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Total Revenue</p>
                                <p class="summary-value">{{ revenueCurrentYear }} TND</p>
                            </div>
                            <div class="summary-icon summary-icon-orange">
                                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path
                                        d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z">
                                    </path>
                                    <path fill-rule="evenodd"
                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.51-1.31c-.562-.649-1.413-1.076-2.353-1.253V5z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card summary-blue">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Avg. Revenue/Month</p>
                                <p class="summary-value">{{ avgPerMonth.toFixed(2) }} TND</p>
                            </div>
                            <div class="summary-icon summary-icon-blue">
                                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path
                                        d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card summary-green">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Growth Rate</p>
                                <p class="summary-value">+{{ getGrowthRate() }}%</p>
                            </div>
                            <div class="summary-icon summary-icon-green">
                                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistants Tab -->
            <div *ngSwitchCase="'assistants'" class="tab-content">
                <!-- Enhanced Assistant Charts Section -->
                <div class="assistants-charts-grid">

                    <!-- Line Chart Card - Assistant Trends -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Assistant Creation Trends</h3>
                            <div class="chart-header-right">
                                <div class="chart-legend">
                                    <div class="legend-dot"></div>
                                    <span class="legend-label">Total Assistants</span>
                                </div>
                                <div class="chart-icon">
                                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-background"></div>
                            <div class="assistant-chart-content">
                                <canvas baseChart [data]="assistantsChartData" [type]="'line'"
                                    [options]="assistantsChartOptions">
                                </canvas>
                            </div>
                            <div class="chart-buttons">
                                <button (click)="loadAssistantsStats('per_day')"
                                    class="chart-btn btn-blue">Daily</button>
                                <button (click)="loadAssistantsStats('par_month')"
                                    class="chart-btn btn-green">Monthly</button>
                            </div>
                        </div>

                        <!-- Trend Statistics -->
                        <div class="trend-stats">
                            <div class="trend-stat stat-orange">
                                <p class="stat-label">Peak Period</p>
                                <p *ngIf="assistantsStatsLoaded ; else loading" class="stat-value">{{ getPeakPeriod()
                                    }}</p>
                            </div>
                            <div class="trend-stat stat-blue">
                                <p class="stat-label">Growth Rate</p>
                                <p *ngIf="assistantsStatsLoaded ; else loading" class="stat-value">+{{
                                    getAssistantGrowthRate() }}%</p>
                            </div>
                            <ng-template #loading>
                                <span class="loading-text">Loading...</span>
                            </ng-template>

                        </div>
                    </div>

                    <!-- Doughnut Chart Card - Assistant Status -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Assistant Status</h3>
                            <div class="chart-icon">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707M12 21v-1m8-8h-1M6.343 18.343l-.707.707M16.657 18.343l.707.707M9.88 9.88a3 3 0 104.24 4.24 3 3 0 00-4.24-4.24z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-background chart-bg-green"></div>
                            <div class="doughnut-container">
                                <div class="doughnut-wrapper">
                                    <canvas baseChart [data]="assistantsDoughnutChartData" [type]="'doughnut'"
                                        [options]="assistantsDoughnutChartOptions" class="doughnut-chart">
                                    </canvas>
                                    <!-- Center Statistics -->
                                    <div class="doughnut-center">
                                        <p class="center-value">{{ totalAssistants }}</p>
                                        <p class="center-label">Total</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Status Statistics -->
                        <div class="status-stats">
                            <div class="status-stat stat-green">
                                <p class="stat-label">Active Rate</p>
                                <p class="stat-value">{{ getActiveRate() }}%</p>
                            </div>
                            <div class="status-stat stat-red">
                                <p class="stat-label">Inactive Rate</p>
                                <p class="stat-value">{{ getInactiveRate() }}%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assistant Summary Cards -->
                <div class="assistant-summary-cards">
                    <div class="summary-card summary-orange">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Total Created</p>
                                <p class="summary-value">{{ totalAssistants }}</p>
                            </div>
                            <div class="summary-icon summary-icon-orange">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card summary-green">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Active Now</p>
                                <p class="summary-value">{{ activeCount }}</p>
                            </div>
                            <div class="summary-icon summary-icon-green">
                                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card summary-red">
                        <div class="summary-content">
                            <div>
                                <p class="summary-label">Inactive</p>
                                <p class="summary-value">{{ inactiveCount }}</p>
                            </div>
                            <div class="summary-icon summary-icon-red">
                                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>